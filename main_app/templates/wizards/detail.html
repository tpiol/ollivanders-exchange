{% extends 'base.html' %}
{% load static %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/wizards/wizard-detail.css' %}" />
{% endblock %}

{% block content %}
<main class="wizard-page"> 


  <section class="wizard-card {{ wizard.get_house_display|lower }}">
    <div class="wizard-header">
      <img src="{{ wizard.image }}" alt="{{ wizard.name }}" class="wizard-img"/>
      <div class="wizard-info">
        <h1>{{ wizard.name }}</h1>
        <p><strong>Date of Birth:</strong> {{ wizard.dateOfBirth }}</p>
        <p><strong>House:</strong> {{ wizard.get_house_display }}</p>
        <p><strong>Patronus:</strong> {{ wizard.patronus }}</p>
      </div>
    </div>

  
    <div class="wand-section">
      <h2>Wand</h2>

      {% if wizard.wand_set.exists %}
        <table>
          <thead>
            <tr>
              <th>Wood</th>
              <th>Core</th>
              <th>Length</th>
            </tr>
          </thead>
          <tbody>
            {% for wand in wizard.wand_set.all %}
              <tr>
                <td>{{ wand.get_wood_display }}</td>
                <td>{{ wand.get_core_display }}</td>
                <td>{{ wand.length }}"</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="wand-actions">
          {% for wand in wizard.wand_set.all %}
            <a href="{% url 'wand-update' wand.id %}" class="btn edit">edit wand</a>
            <a href="{% url 'wand-delete' wand.id %}" class="btn danger">delete wand</a>
          {% endfor %}
        </div>
      {% else %}
        <p class="empty-msg">✨ No wand assigned yet!</p>
        <form action="{% url 'add-wand' wizard.id %}" method="post" autocomplete="off">
          {% csrf_token %} 
          {{ wand_form.as_p }}
          <button type="submit" class="btn submit">Add Wand</button>
        </form>
      {% endif %}
    </div>
  </section>


  <section class="spellbook-card">
    <h2>Spellbook</h2>

    <h3>Known Spells</h3>
    <div class="spell-grid">
      {% for spell in wizard.spells.all %}
        <div class="spell-card">
          <h4>{{ spell.name }}</h4>
          <p>{{ spell.description }}</p>
        </div>
      {% empty %}
        <p class="empty-msg">✨ No spells learned yet.</p>
      {% endfor %}
    </div>

    <div class="spell-form">
      <h3>Learn a New Spell</h3>
      <form action="" method="post">
        {% csrf_token %}
        <select name="spell" class="spell-dropdown">
          {% for spell in all_spells %}
            <option value="{{ spell.id }}">{{ spell.name }} – {{ spell.description }}</option>
          {% empty %}
            <option disabled>No spells available</option>
          {% endfor %}
        </select>
        <button type="submit" class="btn submit">Learn Spell</button>
      </form>
    </div>
  </section>

</main>
{% endblock %}